<app-user-nav-bar></app-user-nav-bar>

<div class="app-shell">
  <app-user-side-bar></app-user-side-bar>

  <div class="app-container">
    <div class="analytics-header">
      <div class="header-content">
        <h1 class="page-title">üìä Leave Analytics</h1>
        <p class="page-subtitle">Comprehensive insights into company-wide leave patterns and trends</p>
      </div>

      <div class="header-controls">
        <div class="filter-group">
          <select class="filter-select" [(ngModel)]="selectedTimeRange" (change)="onTimeRangeChange()">
            <option value="6months">Last 6 Months</option>
            <option value="12months" selected>Last 12 Months</option>
            <option value="2years">Last 2 Years</option>
          </select>

          <select class="filter-select" [(ngModel)]="selectedDepartment" (change)="onDepartmentChange()">
            <option value="all">All Departments</option>
            <option *ngFor="let dept of departmentStats" [value]="dept.department">
              {{ dept.department }}
            </option>
          </select>
        </div>

        <div class="action-buttons">
          <button class="btn btn-secondary" (click)="refreshData()" [disabled]="isLoading">
            <i class="fas fa-sync-alt" [class.spinning]="isLoading"></i> Refresh
          </button>
          <button class="btn btn-primary" (click)="exportData()">
            <i class="fas fa-download"></i> Export
          </button>
        </div>
      </div>
    </div>

    <div *ngIf="isLoading" class="loading-overlay">
      <div class="spinner"></div>
      <p>Loading analytics data...</p>
    </div>
    <div *ngIf="!isLoading" class="stats-grid">
      <div class="stat-card">
        <div class="stat-icon"><i class="fas fa-clipboard-list"></i></div>
        <div class="stat-content">
          <h3 class="stat-number">{{ totalStats.totalRequests }}</h3>
          <p class="stat-label">Total Requests</p>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon approved"><i class="fas fa-check-circle"></i></div>
        <div class="stat-content">
          <h3 class="stat-number">{{ totalStats.approvedRequests }}</h3>
          <p class="stat-label">Approved</p>
          <p class="stat-sub">{{ (totalStats.approvedRequests / totalStats.totalRequests * 100) | number:'1.0-1' }}% approved</p>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon pending"><i class="fas fa-clock"></i></div>
        <div class="stat-content">
          <h3 class="stat-number">{{ totalStats.pendingRequests }}</h3>
          <p class="stat-label">Pending</p>
          <p class="stat-sub">{{ (totalStats.pendingRequests / totalStats.totalRequests * 100) | number:'1.0-1' }}% pending</p>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon rejected"><i class="fas fa-times-circle"></i></div>
        <div class="stat-content">
          <h3 class="stat-number">{{ totalStats.rejectedRequests }}</h3>
          <p class="stat-label">Rejected</p>
          <p class="stat-sub">{{ (totalStats.rejectedRequests / totalStats.totalRequests * 100) | number:'1.0-1' }}% rejected</p>
        </div>
      </div>
    </div>

    <div *ngIf="!isLoading" class="charts-grid">
      <div class="chart-card">
        <div class="chart-header">
          <h3 class="chart-title">üìà Leave Trends</h3>
        </div>
        <div class="chart-container">
          <canvas id="leaveTrendsChart"></canvas>
        </div>
      </div>

      <div class="chart-card">
        <div class="chart-header">
          <h3 class="chart-title">üè¢ Department Analysis</h3>
        </div>
        <div class="chart-container">
          <canvas id="departmentChart"></canvas>
        </div>
      </div>

      <div class="chart-card">
        <div class="chart-header">
          <h3 class="chart-title">üóìÔ∏è Seasonal Distribution</h3>
        </div>
        <div class="chart-container">
          <canvas id="seasonalChart"></canvas>
        </div>
      </div>

      <div class="chart-card table-card">
        <div class="chart-header">
          <h3 class="chart-title">üìã Department Performance</h3>
        </div>
        <div class="table-container">
          <table class="performance-table">
            <thead>
              <tr>
                <th>Department</th>
                <th>Total</th>
                <th>Approved</th>
                <th>Pending</th>
                <th>Avg Days</th>
                <th>Approval %</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let dept of departmentStats">
                <td>{{ dept.department }}</td>
                <td>{{ dept.totalLeaves }}</td>
                <td class="approved-count">{{ dept.approvedLeaves }}</td>
                <td class="pending-count">{{ dept.pendingLeaves }}</td>
                <td>{{ dept.averageDays | number:'1.1-1' }}</td>
                <td>
                  {{ (dept.approvedLeaves / dept.totalLeaves * 100) | number:'1.0-1' }}%
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <div *ngIf="!isLoading" class="insights-section">
      <h3 class="insights-title">üîç Key Insights</h3>
      <div class="insights-grid">
        <div class="insight-card">
          <div class="insight-icon"><i class="fas fa-trending-up"></i></div>
          <div class="insight-content">
            <h4>Peak Season</h4>
            
          </div>
        </div>

        <div class="insight-card">
          <div class="insight-icon"><i class="fas fa-users"></i></div>
          <div class="insight-content">
            <h4>Top Department</h4>
            <p>
             
            </p>
          </div>
        </div>

        <div class="insight-card">
          <div class="insight-icon"><i class="fas fa-percentage"></i></div>
          <div class="insight-content">
            <h4>Approval Efficiency</h4>
            <p>
              {{ (totalStats.approvedRequests / totalStats.totalRequests * 100) | number:'1.0-1' }}%
              company-wide approval rate.
            </p>
          </div>
        </div>

        <div class="insight-card">
          <div class="insight-icon"><i class="fas fa-calendar-alt"></i></div>
          <div class="insight-content">
            <h4>Requests Distribution</h4>
            <p>
              Total of {{ totalStats.totalRequests }} requests across
              {{ departmentStats.length }} departments analyzed.
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
