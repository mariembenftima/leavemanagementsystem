<app-user-nav-bar></app-user-nav-bar>

<div class="app-shell">
  <div class="shell-content">
    <app-user-side-bar></app-user-side-bar>

    <div class="page-content">
      <div class="container" *ngIf="!isLoading && !hasError; else loadingOrError">
        <div class="header">
          <h1><i class="fas fa-user-circle"></i> Employee Profile</h1>
          <div class="action-buttons">
            <button class="btn btn-secondary" (click)="downloadProfile()">
              <i class="fas fa-download"></i> Download PDF
            </button>
          </div>
        </div>

        <div class="profile-main" *ngIf="employeeData">
          <!-- LEFT PANEL -->
          <div class="left-panel">
            <div id="profilePrintable">
              <div class="profile-card">
                <div class="profile-image-container">
                  <img
                    [src]="employeeData.profilePictureUrl || 'assets/user.png'"
                    alt="Profile"
                    class="profile-image"
                    (click)="changeProfileImage()"
                  />
                  <div
                    class="status-indicator"
                    [title]="employeeData.isActive ? 'Active Employee' : 'Inactive'"
                  ></div>
                </div>

                <div class="profile-name">{{ employeeData.fullname }}</div>
                <div class="profile-role text-uppercase">
                  {{ employeeData.roles }}
                </div>
                <div class="profile-id">{{ employeeData.employeeId }}</div>

                <div class="stats-grid">
                  <div class="stat-item">
                    <div class="stat-value">
                      {{
                        (new Date().getFullYear() -
                          (employeeData.joinDate | date: 'yyyy')) || 0
                      }}
                    </div>
                    <div class="stat-label">Years Experience</div>
                  </div>
                </div>

                <div class="quick-actions">
                  <button class="quick-btn" (click)="sendMessage()">
                    <i class="fas fa-message"></i> Message
                  </button>
                  <button class="quick-btn" (click)="scheduleCall()">
                    <i class="fas fa-phone"></i> Call
                  </button>
                  <button class="quick-btn" (click)="viewReports()">
                    <i class="fas fa-chart-line"></i> Reports
                  </button>
                </div>
              </div>
            </div>

            <!-- LEAVE BALANCE -->
            <div class="leave-summary" *ngIf="leaveBalances">
              <h3 class="section-title">
                <i class="fas fa-calendar-alt"></i>
                Leave Balance
              </h3>

              <div class="leave-items">
                <div
                  class="leave-item"
                  *ngFor="let key of (leaveBalances | keyvalue)"
                  (click)="viewLeaveDetails(key.key)"
                >
                  <div class="leave-header">
                    <span class="leave-type text-capitalize">{{ key.key }} Leave</span>
                    <div class="leave-numbers">
                      <span class="leave-badge badge-used">
                        Used: {{ key.value.used }}
                      </span>
                      <span class="leave-badge badge-remaining">
                        Remaining:
                        {{
                          (key.value.carryover + key.value.used) - key.value.used
                        }}
                      </span>
                    </div>
                  </div>
                  <div class="progress-bar">
                    <div
                      class="progress-fill"
                      [style.width]="
                        (key.value.used /
                          (key.value.carryover + key.value.used || 1)) * 100 + '%'
                      "
                    ></div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- RIGHT PANEL -->
          <div class="right-panel">
            <!-- Employee Information -->
            <div class="info-card">
              <h3 class="section-title">
                <i class="fas fa-id-card"></i>
                Employee Information
              </h3>
              <div class="info-grid">
                <div class="info-item">
                  <div class="info-label">Department</div>
                  <div class="info-value">{{ employeeData.department }}</div>
                </div>
                <div class="info-item">
                  <div class="info-label">Designation</div>
                  <div class="info-value">{{ employeeData.designation }}</div>
                </div>
                <div class="info-item">
                  <div class="info-label">Join Date</div>
                  <div class="info-value">
                    {{ employeeData.joinDate | date: 'longDate' }}
                  </div>
                </div>
                <div class="info-item">
                  <div class="info-label">Gender</div>
                  <div class="info-value">{{ employeeData.gender }}</div>
                </div>
                <div class="info-item">
                  <div class="info-label">Nationality</div>
                  <div class="info-value">{{ employeeData.nationality }}</div>
                </div>
                <div class="info-item">
                  <div class="info-label">Marital Status</div>
                  <div class="info-value">{{ employeeData.maritalStatus }}</div>
                </div>
              </div>
            </div>

            <!-- Contact Information -->
            <div class="info-card">
              <h3 class="section-title">
                <i class="fas fa-address-book"></i>
                Contact Information
              </h3>
              <div class="info-grid">
                <div class="info-item">
                  <div class="info-label">Email</div>
                  <a [href]="'mailto:' + employeeData.email" class="contact-info">
                    <i class="fas fa-envelope"></i>
                    {{ employeeData.email }}
                  </a>
                </div>
                <div class="info-item">
                  <div class="info-label">Phone</div>
                  <a [href]="'tel:' + employeeData.phone" class="contact-info">
                    <i class="fas fa-phone"></i>
                    {{ employeeData.phone }}
                  </a>
                </div>
                <div class="info-item">
                  <div class="info-label">Emergency Contact</div>
                  <a
                    [href]="'tel:' + employeeData.emergencyContactPhone"
                    class="contact-info"
                  >
                    <i class="fas fa-phone-alt"></i>
                    {{ employeeData.emergencyContactPhone }}
                  </a>
                </div>
                <div class="info-item">
                  <div class="info-label">Current Address</div>
                  <div class="info-value">{{ employeeData.address }}</div>
                </div>
              </div>
            </div>

            <!-- Recent Activity -->
            <div class="info-card">
              <h3 class="section-title">
                <i class="fas fa-history"></i>
                Recent Activity
              </h3>
              <div class="timeline-section" *ngIf="employeeData">
                <div class="timeline">
                  <div class="timeline-item">
                    <div class="timeline-date">
                      {{ employeeData.updatedAt | date: 'mediumDate' }}
                    </div>
                    <div class="timeline-event">
                      Profile updated or reviewed
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Upcoming Holidays -->
            <div class="holidays-card">
              <h3 class="section-title">
                <i class="fas fa-calendar-check"></i>
                Upcoming Holidays
              </h3>

              <div class="filter-tabs">
                <button class="filter-tab active" (click)="filterHolidays('all')">
                  All
                </button>
                <button class="filter-tab" (click)="filterHolidays('upcoming')">
                  Upcoming
                </button>
                <button class="filter-tab" (click)="filterHolidays('optional')">
                  Optional
                </button>
                <button class="filter-tab" (click)="filterHolidays('national')">
                  National
                </button>
              </div>

              <div class="holidays-list">
                <div
                  class="holiday-item"
                  *ngFor="let h of holidaysList"
                  [attr.data-category]="h.type"
                >
                  <span class="holiday-emoji">ðŸŽ‰</span>
                  <div class="holiday-info">
                    <div class="holiday-name">{{ h.name }}</div>
                    <div class="holiday-date">{{ h.date | date: 'longDate' }}</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Loading/Error -->
      <ng-template #loadingOrError>
        <div class="loading" *ngIf="isLoading">Loading profile...</div>
        <div class="error" *ngIf="hasError">
          Failed to load employee data. Please try again later.
        </div>
      </ng-template>
    </div>
  </div>
</div>
