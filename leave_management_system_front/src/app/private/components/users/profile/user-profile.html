<app-user-nav-bar></app-user-nav-bar>

<div class="app-shell">
  <div class="shell-content">
    <app-user-side-bar></app-user-side-bar>

    <div class="page-content">
      <div class="container" *ngIf="!isLoading && !hasError; else loadingOrError">
        <div class="header">
          <h1><i class="fas fa-user-circle"></i> Employee Profile</h1>
          <div class="action-buttons">
            <button class="btn btn-secondary" (click)="downloadProfile()">
              <i class="fas fa-download"></i> Download PDF
            </button>
          </div>
        </div>

        <div class="profile-main" *ngIf="employeeData">
          <!-- LEFT PANEL -->
          <div class="left-panel">
            <div id="profilePrintable">
              <div class="profile-card">
                <div class="profile-image-container">
                  <img src="assets/default-profile.png" alt="Profile photo" class="profile-image"
                    (click)="changeProfileImage()" />
                  <div class="status-indicator" [title]="employeeData.isActive ? 'Active Employee' : 'Inactive'"></div>
                </div>

                <div class="profile-name">{{ employeeData.fullname }}</div>
                <div class="profile-role text-uppercase">
                  {{ employeeData.roles }}
                </div>
                <div class="profile-id">{{ employeeData.employee_id }}</div>

                <div class="stats-grid">
                  <div class="stat-item">
                    <div class="stat-value">
                      {{ this['getYearsOfExperience']() }}
                    </div>
                    <div class="stat-label">Years Experience</div>
                  </div>
                </div>

                <div class="quick-actions">
                  <button class="quick-btn" (click)="sendMessage()">
                    <i class="fas fa-message"></i> Message
                  </button>
                  <button class="quick-btn" (click)="scheduleCall()">
                    <i class="fas fa-phone"></i> Call
                  </button>
                  <button class="quick-btn" (click)="viewReports()">
                    <i class="fas fa-chart-line"></i> Reports
                  </button>
                </div>
              </div>
            </div>

            <!-- LEAVE BALANCE -->
            <div class="leave-summary" *ngIf="leaveBalances">
              <h3 class="section-title">
                <i class="fas fa-calendar-alt"></i>
                Leave Balance
              </h3>

              <div class="leave-items">
                <div class="leave-item" *ngFor="let key of (leaveBalances | keyvalue)"
                  (click)="viewLeaveDetails(key.key)">
                  <div class="leave-header">
                    <span class="leave-type text-capitalize">{{ key.key }} Leave</span>
                    <div class="leave-numbers">
                      <span class="leave-badge badge-used">
                        Used: {{ key.value.used }}
                      </span>
                      <span class="leave-badge badge-remaining">
                        Remaining:
                        {{
                        (key.value.carryover + key.value.used) - key.value.used
                        }}
                      </span>
                    </div>
                  </div>
                  <div class="progress-bar">
                    <div class="progress-fill" [style.width]="
                        (key.value.used /
                          (key.value.carryover + key.value.used || 1)) * 100 + '%'
                      "></div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- RIGHT PANEL -->
          <div class="right-panel">
            <!-- Employee Information -->
            <div class="info-card">
              <h3 class="section-title">
                <i class="fas fa-id-card"></i>
                Employee Information
              </h3>
              <div class="info-grid">
                <div class="info-item">
                  <div class="info-label">Department</div>
                  <div class="info-value">{{ employeeData.department }}</div>
                </div>
                <div class="info-item">
                  <div class="info-label">Designation</div>
                  <div class="info-value">{{ employeeData.designation }}</div>
                </div>
                <div class="info-item">
                  <div class="info-label">Join Date</div>
                  <div class="info-value">
                    {{ employeeData.join_date | date: 'longDate' }}
                  </div>
                </div>
                <div class="info-item">
                  <div class="info-label">Gender</div>
                  <div class="info-value">{{ employeeData.gender }}</div>
                </div>
                <div class="info-item">
                  <div class="info-label">Nationality</div>
                  <div class="info-value">{{ employeeData.nationality }}</div>
                </div>
                <div class="info-item">
                  <div class="info-label">Marital Status</div>
                  <div class="info-value">{{ employeeData.marital_status }}</div>
                </div>
              </div>
            </div>

            <!-- Contact Information -->
            <div class="info-card">
              <h3 class="section-title">
                <i class="fas fa-address-book"></i>
                Contact Information
              </h3>
              <div class="info-grid">
                <div class="info-item">
                  <div class="info-label">Email</div>
                  <a [href]="'mailto:' + employeeData.email" class="contact-info">
                    <i class="fas fa-envelope"></i>
                    {{ employeeData.email }}
                  </a>
                </div>
                <div class="info-item">
                  <div class="info-label">Phone</div>
                  <a [href]="'tel:' + employeeData.phone" class="contact-info">
                    <i class="fas fa-phone"></i>
                    {{ employeeData.phone }}
                  </a>
                </div>
                <div class="info-item">
                  <div class="info-label">Emergency Contact</div>
                  <a [href]="'tel:' + employeeData.emergency_contact_phone" class="contact-info">
                    <i class="fas fa-phone-alt"></i>
                    {{ employeeData.emergency_contact_phone }}
                  </a>
                </div>
                <div class="info-item">
                  <div class="info-label">Current Address</div>
                  <div class="info-value">{{ employeeData.address }}</div>
                </div>
              </div>
            </div>

            <!-- Upcoming Holidays -->
            <div class="holidays-card">
              <h3 class="section-title">
                <i class="fas fa-calendar-check"></i>
                Upcoming Holidays
              </h3>

              <div class="filter-tabs">
                <button class="filter-tab active" (click)="filterHolidays('all', $event)">
                  All
                </button>
                <button class="filter-tab" (click)="filterHolidays('upcoming', $event)">
                  Upcoming
                </button>
                <button class="filter-tab" (click)="filterHolidays('optional', $event)">
                  Optional
                </button>
                <button class="filter-tab" (click)="filterHolidays('national', $event)">
                  National
                </button>
              </div>

              <div class="holidays-list" *ngIf="this['holidaysList']?.length">
                <div class="holiday-item" *ngFor="let h of this['holidaysList']" [attr.data-category]="h.type">
                  <span class="holiday-emoji">ðŸŽ‰</span>
                  <div class="holiday-info">
                    <div class="holiday-name">{{ h.name }}</div>
                    <div class="holiday-date">{{ h.date | date: 'longDate' }}</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Loading/Error -->
      <ng-template #loadingOrError>
        <ng-container *ngIf="isLoading">
          <div class="loading">Loading profile...</div>
        </ng-container>
        <ng-container *ngIf="hasError">
          <div class="error">
            Failed to load employee data. Please try again later.
          </div>
        </ng-container>
      </ng-template>
    </div>
  </div>
</div>
